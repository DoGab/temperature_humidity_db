<!DOCTYPE HTML>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>

function getTempData(data) {
  var dataArray = [];
  for(var i = 0; i < data.length; i++) {
    var time = new Date(data[i].timestamp);
    dataArray.push({
		  x: time,
		  y: data[i].temperature
	  });
    //alert(time);
  }
  return dataArray;
}

function getHumData(data) {
  var dataArray = [];
  for(var i = 0; i < data.length; i++) {
    var time = new Date(data[i].timestamp);
    dataArray.push({
		  x: time,
		  y: data[i].humidity
	  });
    //alert(time);
  }
  return dataArray;
}


window.onload = function () {

event.preventDefault();

var request;
request = $.ajax({
    type: 'GET',
    dataType: 'json',
    url: "/sqlite_query.php",
});


request.done(function(msg) {
  //alert ( "Response: " + JSON.stringify(msg) );
  console.log(msg);


var dataPoints1 = getTempData(msg);
//alert(JSON.stringify(dataPoints1));
var dataPoints2 = getHumData(msg);
//alert(JSON.stringify(dataPoints2));

var chart = new CanvasJS.Chart("chartContainer", {
	animationEnabled: true,
	title:{
		text: "Temperature And Humidity Time Graph"
	},
	toolTip: {
		shared: true
	},
	axisX: {
		title: "Time",
	},
	axisY: {
		title: "Temperature",
		titleFontColor: "#4F81BC",
		suffix : "°",
    minimum : 10,
    maximum : 40,
		lineColor: "#4F81BC",
		tickColor: "#4F81BC"
	},
	axisY2: {
		title: "Humidity",
		titleFontColor: "#C0504E",
		suffix : "%",
    minimum : 0,
    maximum : 60,
		lineColor: "#C0504E",
		tickColor: "#C0504E"
	},
	data: [{
		type: "spline",  
		axisYType: "secondary",
		name: "humidity",
    xValueType: "dateTime",
    xValueFormatString: "DD-MM-YYYY HH:mm",
		yValueFormatString: "#,#0.# %",
		dataPoints: dataPoints2
	},
  {
		type: "spline",
		name: "temperature",
    xValueType: "dateTime",
		yValueFormatString: "#,##0.00°",
		dataPoints: dataPoints1
	}]
});
chart.render();


  return chart;
});

}
</script>
</head>
  <body>
    <div id="chartContainer" style="height: 370px; width: 100%;"></div>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
  </body>
</html>
